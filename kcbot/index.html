<!DOCTYPE html>
<html>

<head>
    <title>Robot</title>
    <meta name="viewport" content="width=device-width,
                                   initial-scale=1.0,
                                   maximum-scale=1.0,
                                   user-scalable=no,
                                   minimal-ui">
    <link rel="stylesheet" href="//cdn.kik.com/app/2.0.1/app.min.css">
    <style>
    /* put your styles here */
    </style>
</head>

<body>

    <div class="app-page" data-page="main">
        <div class="app-topbar">
            <div class="app-title">Robot</div>
        </div>
        <div class="app-content">
            <div id="chat" class="app-section"></div>
            <input class="app-input left">
            <div id="send" class="app-button right green">Send</div>
        </div>
    </div>

    <script src="//zeptojs.com/zepto.min.js"></script>
    <script src="//cdn.kik.com/app/2.0.1/app.min.js"></script>

    <script>
    var server = new WebSocket("ws://kcbot.herokuapp.com");

    server.onmessage = function(m) {
        if (m.data !== "ping")
            App.load("main", {text: m.data});
    };

    server.onopen = function() {
        try {
            App.restore();
        } catch (err) {
            App.load("main", {text: "<b>Talk to me! I am a robot! :)</b>"});
        }
    }

    App.controller("main", function(page, data) {
        $(page)
            .find("#chat")
            .append(data.text ? "<p>" + data.text + "</p>" : "");

        $(page)
            .find("#send")
            .click(function() {
                server.send($("input").val());
                $("input").val("");
            });
    });
    </script>

</body>

</html>
