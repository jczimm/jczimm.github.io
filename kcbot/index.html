<!DOCTYPE html>
<html>

<head>
    <title>Robot</title>
    <meta name="viewport" content="width=device-width,
                                   initial-scale=1.0,
                                   maximum-scale=1.0,
                                   user-scalable=no,
                                   minimal-ui">
    <link rel="stylesheet" href="//cdn.kik.com/app/2.0.1/app.min.css">
    <style>
    #form {
        position: fixed;
        bottom: 0;
    }
    </style>
</head>

<body>

    <div class="app-page" data-page="main">
        <div class="app-topbar">
            <div class="app-title">Robot</div>
        </div>
        <div class="app-content">
            <div id="chat" class="app-section"></div>
            <div id="form">
                <input class="app-input">
                <div id="send" class="app-button green">Send</div>
            </div>
        </div>
    </div>

    <script src="//zeptojs.com/zepto.min.js"></script>
    <script src="//cdn.kik.com/app/2.0.1/app.min.js"></script>

    <script>
    var server = new WebSocket("ws://kcbot.herokuapp.com");

    server.onmessage = function(m) {
        if (m.data !== "ping") bot(m.data);
    };

    server.onopen = function() {
        try {
            App.restore();
        } catch (err) {
            App.load("main");
        }
    }

    function bot(text) {
        $("#chat").append(text ? "<q>" + text + "</q>" : "");
    }

    function me(text) {
        $("#chat").append(text ? "<p>" + text + "</p>" : "");
    }

    App.controller("main", function(page) {
        $(page)
            .find("#chat")
            .html("<b>Talk to me, I am a robot! :]</b>");

        $(page)
            .find("#send")
            .click(function() {
                var text = $("input").val();
                if (text !== "") {
                    server.send(text);
                    me(text);
                    $("input").val("");
                }
            });
    });
    </script>

</body>

</html>
